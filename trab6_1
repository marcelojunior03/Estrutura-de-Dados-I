//Nome: Marcelo Heiffig JÃºnior - RA: CV3095126

#include <stdio.h>
#include <stdbool.h>
#include <string.h>
#include <ctype.h>
#include <stdlib.h>

#define MAXVEN 20
#define MAXCLI 10
#define MAXATE 20

struct data{
    short int dia, mes;
    int ano;
};
typedef struct data Data;

struct atendimento{
    char nomeVendedor[50];
    char nomeCliente[50];
    Data umaData;
    float nota;
};
typedef struct atendimento Atendimento;

void cadastrarClientes(char clientes[MAXCLI][50], int *quantos){
    system("cls");
    char continua;

    do
    {
        fflush(stdin);
        printf("\nDigite o nome do cliente %i: ", *quantos+1);
        gets(clientes[*quantos]);
        *quantos = *quantos + 1;

        fflush(stdin);
        printf("\nCadastrar mais um cliente? (S/N) ");
        continua = getchar();
    }
    while(toupper(continua) == 'S' && *quantos < MAXCLI);
}

bool jaExisteVen(char nome[50], char vendedores[MAXVEN][50], int quantos){
    bool achou = false;

    for(int i = 0; i < quantos; i++){
        if(strcmp(nome, vendedores[i]) == 0){
            achou = true;
        }
    }
    return achou;
}

bool jaExisteCli(char nome[50], char clientes[MAXCLI][50], int quantos){
    bool achou = false;

    for(int i = 0; i < quantos; i++){
        if(strcmp(nome, clientes[i]) == 0){
            achou = true;
        }
    }
    return achou;
}

void cadastrarVendedores(char vendedores[MAXVEN][50], int *quantos){
    system("cls");
    char nome[50];
    char continua;

    do{
        do{
            fflush(stdin);
            printf("\nDigite o nome do vendedor: ");
            gets(nome);

            if(jaExisteVen(nome, vendedores, *quantos)){
                printf("\nO vendedor ja esta cadastrado!");
            }
        }
        while(jaExisteVen(nome, vendedores, *quantos));

        strcpy(vendedores[*quantos], nome);
        *quantos = *quantos + 1;

        fflush(stdin);
        printf("\nCadastrar mais um vendedor? (S/N) ");
        continua = getchar();
    }
    while(toupper(continua) == 'S' && *quantos < MAXVEN);
}

void cadastrarAtendimentos(Atendimento atendimentos[MAXATE], int *quantos, char clientes[MAXCLI][50], int quantosClientes, char vendedores[MAXVEN][50], int quantosVendedores){
    system("cls");
    char nome[50];
    char continua;

    do{
        do{
            fflush(stdin);
            printf("\nDigite o nome do vendedor: ");
            gets(nome);

            if(jaExisteVen(nome, vendedores, quantosVendedores) == false){
                printf("\nO vendedor nao existe!");
            }
        }
        while(jaExisteVen(nome, vendedores, quantosVendedores) == false);

        strcpy(nome, atendimentos[*quantos].nomeVendedor);

        do{
            fflush(stdin);
            printf("\nDigite o nome do cliente: ");
            gets(nome);

            if(jaExisteCli(nome, clientes, quantosClientes) == false){
                printf("\nO cliente nao existe!");
            }
        }
        while(jaExisteCli(nome, clientes, quantosClientes) == false);

        strcpy(nome, atendimentos[*quantos].nomeCliente);

        do{
            fflush(stdin);
            printf("\nDigite o dia do atendimento: ");
            scanf("%i", &atendimentos[*quantos].umaData.dia);

            fflush(stdin);
            printf("\nDigite o mes do atendimento: ");
            scanf("%i", &atendimentos[*quantos].umaData.mes);

            fflush(stdin);
            printf("\nDigite o ano do atendimento: ");
            scanf("%i", &atendimentos[*quantos].umaData.ano);
        }
        while(atendimentos[*quantos].umaData.dia < 0 || atendimentos[*quantos].umaData.dia > 31 ||
              atendimentos[*quantos].umaData.mes < 0 || atendimentos[*quantos].umaData.mes > 12);

        do{
            fflush(stdin);
            printf("\nQual nota voce da ao atendimento (0-10)? ");
            scanf("%f", &atendimentos[*quantos].nota);
        }
        while(atendimentos[*quantos].nota < 0 || atendimentos[*quantos].nota > 10);

        *quantos = *quantos + 1;
        fflush(stdin);
        printf("\nCadastrar mais um atendimento? (S/N) ");
        continua = getchar();
    }
    while(toupper(continua) == 'S' && *quantos < MAXATE);
}

void imprimirRelatorio(Atendimento atendimentos[MAXATE], int quantosAtendimentos){
    system("cls");
    char continua;

    do{
        for(int i = 0; i < quantosAtendimentos; i++){
            printf("\n\nVendedor(a) %c:", atendimentos[i].nomeVendedor);
            printf("\n\nCliente: %c", atendimentos[i].nomeCliente);
            printf("\nData: %i/%i/%i", atendimentos[i].umaData.dia, atendimentos[i].umaData.mes, atendimentos[i].umaData.ano);
            printf("\nNota: %i", atendimentos[i].nota);
        }

        fflush(stdin);
        printf("\nVoltar ao menu? (S/N) ");
        continua = getchar();
    }
    while(toupper(continua) != 'S');
}

void main(){
    char clientes[MAXCLI][50];
    int quantosClientes = 0;
    char vendedores[MAXVEN][50];
    int quantosVendedores = 0;
    Atendimento atendimentos[MAXATE];
    int quantosAtendimentos = 0;
    int opcao = 0;

    do{
        system("cls");
        printf("\nSistema de Atendimentos");
        printf("\n1 - Cadastro de cliente");
        printf("\n2 - Cadastro de vendedor");
        printf("\n3 - Cadastro de atendimento");
        printf("\n4 - Imprimir relatorio");
        printf("\n5 - Sair");

        fflush(stdin);
        printf("\nDigite sua opcao: ");
        scanf("%i", &opcao);

        switch(opcao){
            case 1:{
                cadastrarClientes(clientes, &quantosClientes);
                break;
            }
            case 2:{
                cadastrarVendedores(vendedores, &quantosVendedores);
                break;
            }
            case 3:{
                cadastrarAtendimentos(atendimentos, &quantosAtendimentos, clientes, quantosClientes, vendedores, quantosVendedores);
                break;
            }
            case 4:{
                imprimirRelatorio(atendimentos, quantosAtendimentos);
                break;
            }
            case 5:{
                printf("Obrigado!");
                break;
            }
            default:{
                printf("\nOpcao invalida!");
            }
        }
    }
    while(opcao != 5);
}
